zookeeper和eureka谁更适合做服务发现，主要考虑的是当网络分区，它们各自在这种环境下的表现如何。

## zookeeper - CP

从CAP方面看，zookeeper 是 CP 系统，侧重一致性，弱化可用性。

当发生网络分区时，zookeeper可能会因为网络分区而导致整个集群不可用的情况发生（集群中可通信节点数无法满足Quorum法定人数）。

对于服务发现来说，返回数据也总比没有数据好，即使返回的数据不是完全正确的。

所以，在 ZooKeeper 无法很好地处理网络分区问题的设计下，它也就不适合做服务发现。

## eureka - AP

从CAP方面看，eureka 是 AP 系统，侧重可用性，弱化一致性。

Eureka 就是为服务发现而构建的。它提供了一个客户端库，该库提供了服务心跳、服务健康检查、自动发布及缓存刷新等功能。

如果一个服务器出现问题，Eureka 不需要任何类型的选举，客户端会自动切换并连接到一个新的 Eureka 服务器。当它恢复时，可以自动加入 Eureka 节点集群。

在出现网络分区的情况下，Eureka 将继续接受新的注册并发布，这可以确保新增服务仍然可以供`分区同侧`的客户端使用。

Eureka 有一个服务心跳的概念，可以阻止过期数据：
  
    如果一个服务长时间没有发送心跳，那么 Eureka 将从服务注册中将其删除。
    但在出现网络分区、Eureka 在短时间内丢失过多客户端时，它会停用这一机制，进入“自我保护模式”。
    网络恢复后，它又会自动退出该模式。这样，虽然它保留的数据中可能存在错误，却不会丢失任何有效数据。

Eureka 在客户端会有缓存。即使所有 Eureka 服务器不可用，服务注册信息也不会丢失。缓存在这里是恰当的，因为它只在所有的 Eureka 服务器都没响应的情况下才会用到。



